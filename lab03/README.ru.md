# Лабораторная работа 03: Арифметические выражения

[RU|[EN](README.md)]

Это упражнение расширяет [лабораторную работу 01](../lab01/README.ru.md) до полной поддержки «школьной арифметики», добавляя вычитание, деление, унарное отрицание и переменные в язык выражений. Цель этого — познакомиться со сложными функциями библиотеки Ohm, такими, как передача параметров в семантические действия и поддержка левой рекурсии.

## Цель

Калькулятор, реализованный в этой лабораторной работе, существенно отличается от двух предыдущих: выражение может содержать переменные, поэтому мы больше не можем вычислить его значение непосредственно. Нам нужно будет предоставить *значения* переменных, упомянутых в выражении.
Естественный способ сделать это в TS/JS — через *объект*. Поэтому теперь мы будем вызывать нашу функцию `evaluate` следующим образом:

```typescript
const y = evaluate('x+a', {x: 41, a: 1});
```

РБНФ для расширенной грамматики выглядит следующим образом:

```EBNF
expr = 
    number
  | variable
  | "-" expr
  | expr "+" expr 
  | expr "*" expr
  | expr "-" expr
  | expr "/" expr

variable = letter { letter | digit }
number = digit { digit }
digit = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" | "8" | "9"
```

Обратите внимание, что эта грамматика требует дополнительного устранения неоднозначности помимо приоритетов операций: вычитание и деление *левоассоциативны*.
Выражение `x + (y - z)` не эквивалентно `(x + y) - z`. Если скобок нет, наши обычные правила порядка вычислений требуют выполнения «левой» операции перед выполнением «правой».

## Задания

1. Напишите PEG-грамматику для арифметических выражений, описанных выше с помощью РБФМ, используя синтаксис библиотеки Ohm.
Пустой шаблон грамматики предоставлен в файле [arith.ohm](src/arith.ohm). Заполните его необходимыми правилами.
2. Реализуйте и экспортируйте из [index.ts](src/index.ts) составную функцию `evaluate(content: string): number`  со свойствами, аналогичными такой же функции в [лабораторной работе 01](../lab01/README.ru.md).

## Оценка

- C | 3 | Воу, воу, полегче:
  - Реализуйте базовый синтаксический анализ арифметических выражений
  - Корректно обработать ошибки разбора
  - Убедиться, что деление на ноль выбрасывает исключение
- B | 4 | Ломай меня полностью:
  - Корректно реализовать приоритеты операций и использование необязательных скобок
  - Убедиться, что многократные применения унарного минуса обрабатываются правильно (`--a`)
  - Убедиться, что вычитание и деление реализованы левоассоциативным образом
- A | 5 | Ультранасилие:
  - Реализуйте грамматику без леворекурсивных правил

## Советы

1. Поддержка левой ассоциативности может вызвать затруднения. См. более подробное описание в [assoc.ru.md](assoc.ru.md).
2. Обратите внимание, что в Javascript деление на 0 не является исключительной ситуацией. Результатом этой операции является значение `Infinity`.
