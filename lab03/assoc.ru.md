# Разбор левоассоциативных инфиксных операций

[RU|[EN](./assoc.md)]

В своем исходном виде, PEG поддерживает только правую рекурсию. Другими словами, левая рекурсия в PEG приводит к сбою процесса разбора (см.  подробности в [разделе статьи в Википедии][PEG-LR]).

Библиотека Ohm предлагает два способа решения этой проблемы:

1. **Общий подход**: заменить рекурсию итерацией, разобраться с ассоциативностью после синтаксического разбора:

   ```js
   Hash = At ("#" At)* // здесь Hash не упоминается в правой части правила
   ```

   Идиоматическим решением для описания подобных повторений в Ohm является встроенное шаблонное правило:

   ```js
   Hash = NonemptyListOf<At, "#"> 
   ```

   Этот подход требует от автора парсера либо сменить структуру AST, сделав операцию `#` N-арной вместо бинарной, либо превратить N-арный узел, полученный в результате разбора текста такой грамматикой в бинарное дерево разбора внутри семантического действия:

   ```ts
   Hash(head, tail)
   {
      return tail.children
        .map(t => t.parse())
        .reduce((e, t) => sub(e, t), head.parse());
   }
   ```

2. **Специфичный для Ohm** подход основан на [статье][Packrat-LR], опубликованной автором библиотеки Ohm - он *допускает* левую рекурсию, в отличие от большинства других PEG-парсеров, встречающихся в природе:

   ```js
   Hash = Hash "#" At | At // прямая левая рекурсия!
   ```

   Этот метод наиболее удобен для разработчиков парсеров, так как он позволяет естественным образом выражать левоассоциативность бинарных операций без лишних обязанностей по свертке N-арных последовательностей аргументов в бинарные деревья разбора.

[PEG-LR]: https://ru.wikipedia.org/wiki/%D0%93%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0,_%D1%80%D0%B0%D0%B7%D0%B1%D0%B8%D1%80%D0%B0%D1%8E%D1%89%D0%B0%D1%8F_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5#%D0%9D%D0%B5%D0%BF%D1%80%D1%8F%D0%BC%D0%B0%D1%8F_%D0%BB%D0%B5%D0%B2%D0%B0%D1%8F_%D1%80%D0%B5%D0%BA%D1%83%D1%80%D1%81%D0%B8%D1%8F
[Packrat-LR]: https://tinlizzie.org/VPRIPapers/tr2007002_packrat.pdf
