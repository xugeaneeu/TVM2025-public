# Лабораторная работа 08: Синтаксический анализ Funny

[RU|[EN](README.md)]

Цель этой работы - разработать парсер крошечного императивного языка Funny, и попрактиковаться в возможностях по наследованию и повторному использованию грамматик, предлагаемых библиотекой Ohm.

## Цель

В этой лабораторной работе мы построим парсер для грамматического подмножества игрушечного языка Funny. Подробное описание синтаксиса Funny приведено в [funny.ru.md](../funny.ru.md).

В этой лабораторной работе мы будем игнорировать все части Funny, относящиеся к верификации:

1. Пред- и пост-условия функций
2. Инварианты циклов
3. Определения формул

Обратите внимание на то, что в [лабораторной работе 03](../lab03/README.ru.md) the [грамматика арифметических выражений](../lab03/src/arith.ohm) была построена с нуля, хотя ее правила очень похожи на те, что использовались в [грамматике AddMul](../lab01/src/addmul.ohm) из [лабораторной работы 01](../lab01/README.md).

Библиотека Ohm предлагает более удачный способ обработки связанных грамматик, позволяя авторам парсеров расширять и повторно использовать уже отлаженные грамматики.
Эта лабораторная работа готова к тому, чтобы так и сделать: грамматика языка размещена в [шаблонном файле](./src/funny.ohm.t), который на этапе сборки склеивается с грамматикой, позаимствованной из [лабораторной работы 03](../lab03/README.ru.md). В секции [Grammar Inheritance](https://ohmjs.org/docs/syntax-reference#grammar-inheritance) справочника по синтаксису Ohm приведено больше подробностей о повторном использовании, расширении, и переопределении грамматических правил.

## Задачи

1. Опишите синтаксис Funny при помощи PEG-грамматики в файле [funny.ohm.t](./src/funny.ohm.t)
2. Опишите типы узлов AST в файле [funny.ts](./src/funny.ts)
3. Реализуйте в файле [parser.ts](./src/parser.ts) семантическое действие `parse()` для грамматики, определенной в п.1 выше
4. Реализуйте в файле [parser.ts](./src/parser.ts) функцию `parseFunny()`

## Оценка

- C | 3 | Воу, воу, полегче:
  - Реализуйте разбор подмножества синтаксиса Funny:
    - Модулей, состоящих из единственной функции
    - Функций с целочисленными входными и выходными параметрами
    - Функций, возвращающих единственное значение
    - Операторов присваивания
    - Блочных операторов
  - Реализуйте вывод информации о синтаксических ошибках
  - Проверьте разобранную программу на наличие базовых семантических ошибок:
    - Повторное определение переменной
    - Использование незадекларированного идентификатора
- B | 4 | Ломай меня полностью:
  - Реализуйте разбор расширенного подмножества синтаксиса Funny:
    - Функций с несколькими возвращаемыми значениями
    - Модулей с несколькими функциями
    - Использования вызовов функций в выражениях
    - Условных операторов
    - Операторов цикла
  - Реализуйте проверку соответствия типов:
    - Тип(ы) места назначения в операторе присваивания должны соответствовать типу выражения-источника
    - Арифметические операции должны применяться только к целочисленным выражениям
    - Операции обращения к массиву должны применяться только к выражениям типа массив
    - Типы и количество аргументов в вызовах функций должны соответствовать списку параметров функции
- A | 5 | Мне все ультрафиолетово:
  - Реализуйте разбор полного синтаксиса Funny, за исключением конструкций, относящихся к аннотациям:
    - Использование массивов для входных и выходных параметров
    - Операции обращения к массиву и присваивания элементов массива
    - Присваивание кортежей
  - В семантических ошибках указывайте место их обнаружения
  - Добавьте вывод предупреждений о неиспользованных переменных и параметрах функций
  